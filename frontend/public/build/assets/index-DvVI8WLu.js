import{r as t,j as e,l as f,y as b}from"./main-CKtUqjP5.js";import{g as N,q as w,f as v}from"./index-B1BQ6o6j.js";import{s as T}from"./ConfirmationToast-CIdDE9v9.js";const k=({isOpen:s,onClose:m,onSave:h})=>{const[n,c]=t.useState(""),[r,o]=t.useState(""),[u,p]=t.useState([]),[d,i]=t.useState(!1),[l,g]=t.useState("");t.useEffect(()=>{s&&(f.get("/templates/source-years").then(a=>{const x=a.data.map(j=>j.tahun);p(x),x.length>0&&o(x[0])}),c(""),g(""))},[s]);const y=async a=>{a.preventDefault(),i(!0),g("");try{await f.post("/templates",{nama_template:n,tahun_referensi:r}),h(),m()}catch(x){g(x.response?.data?.message||"Gagal membuat template.")}finally{i(!1)}};return s?e.jsx("div",{className:"fixed inset-0 bg-transparent flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Buat Template Baru"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nama_template",className:"block text-sm font-medium text-gray-700",children:"Nama Template"}),e.jsx("input",{type:"text",id:"nama_template",value:n,onChange:a=>c(a.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tahun_referensi",className:"block text-sm font-medium text-gray-700",children:"Jadikan Program Kerja Tahun Ini Sebagai Referensi"}),e.jsxs("select",{id:"tahun_referensi",value:r,onChange:a=>o(a.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",children:[e.jsx("option",{value:"",children:"Pilih Tahun"}),u.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),l&&e.jsx("p",{className:"text-red-500 text-sm",children:l}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx("button",{type:"button",onClick:m,className:"bg-gray-200 px-4 py-2 rounded-md",children:"Batal"}),e.jsx("button",{type:"submit",disabled:d,className:"bg-indigo-600 text-white px-4 py-2 rounded-md disabled:bg-indigo-300",children:d?"Menyimpan...":"Simpan"})]})]})]})}):null},S=({isOpen:s,onClose:m,onApply:h,template:n})=>{const[c,r]=t.useState(new Date().getFullYear()+1),[o,u]=t.useState(!1),[p,d]=t.useState("");t.useEffect(()=>{s&&(d(""),r(new Date().getFullYear()+1))},[s]);const i=async()=>{u(!0),d("");try{const l=await f.post(`/templates/${n.id}/apply`,{target_year:c});h(l.data.message),m()}catch(l){d(l.response?.data?.message||"Gagal menerapkan template.")}finally{u(!1)}};return s?e.jsx("div",{className:"fixed inset-0 bg-transparent flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Terapkan Template"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Anda akan menerapkan template ",e.jsx("span",{className:"font-semibold",children:n.nama_template})," (dari tahun ",n.tahun_referensi,") untuk membuat program kerja baru."]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"target_year",className:"block text-sm font-medium text-gray-700",children:"Untuk Tahun Program Kerja"}),e.jsx("input",{type:"number",id:"target_year",value:c,onChange:l=>r(l.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"})]}),p&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:p}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx("button",{type:"button",onClick:m,className:"bg-gray-200 px-4 py-2 rounded-md",children:"Batal"}),e.jsx("button",{onClick:i,disabled:o,className:"bg-green-600 text-white px-4 py-2 rounded-md disabled:bg-green-300",children:o?"Menerapkan...":"Terapkan"})]})]})}):null},A=()=>{const[s,m]=t.useState([]),[h,n]=t.useState(!0),[c,r]=t.useState(!1),[o,u]=t.useState(!1),[p,d]=t.useState(null),i=async()=>{n(!0);try{const a=await f.get("/templates");m(a.data)}catch(a){console.error("Error fetching templates:",a)}finally{n(!1)}};t.useEffect(()=>{i()},[]);const l=async a=>{T("Apakah Anda yakin ingin menghapus template ini?",async()=>{try{await f.delete(`/templates/${a}`),i(),b.success("Template berhasil dihapus.")}catch{b.error("Gagal menghapus template.")}})},g=a=>{d(a),u(!0)},y=a=>{b.success(a)};return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-6 space-y-4 md:space-y-0",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Manajemen Template"}),e.jsxs("button",{onClick:()=>r(!0),className:"flex items-center bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 self-start md:self-auto",children:[e.jsx(N,{className:"mr-2"})," Buat Template Baru"]})]}),h?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx("div",{className:"loader"})}):e.jsxs("div",{className:"space-y-4",children:[s.map(a=>e.jsxs("div",{className:"p-4 border rounded-lg flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.nama_template}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Sumber dari Program Kerja Tahun ",a.tahun_referensi]})]}),e.jsxs("div",{className:"flex items-center space-x-2 self-end md:self-auto",children:[e.jsxs("button",{onClick:()=>g(a),className:"flex items-center bg-green-500 text-white px-3 py-1.5 rounded-md text-sm hover:bg-green-600",children:[e.jsx(w,{className:"mr-1.5"})," Terapkan"]}),e.jsx("button",{onClick:()=>l(a.id),className:"p-2 rounded-md hover:bg-red-100",children:e.jsx(v,{className:"text-red-500"})})]})]},a.id)),s.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-4",children:"Belum ada template yang dibuat."})]}),e.jsx(k,{isOpen:c,onClose:()=>r(!1),onSave:i}),p&&e.jsx(S,{isOpen:o,onClose:()=>u(!1),onApply:y,template:p})]})};export{A as default};
