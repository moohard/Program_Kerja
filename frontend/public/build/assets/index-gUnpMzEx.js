import{r as o,j as e,R as F,l as u}from"./main-CKtUqjP5.js";import{l as R,m as A}from"./index-B1BQ6o6j.js";function $(d){const[n,g]=o.useState(document.hasFocus());return o.useEffect(()=>{const i=()=>{d&&d(),g(!0)},x=()=>{g(!1)};return window.addEventListener("focus",i),window.addEventListener("blur",x),()=>{window.removeEventListener("focus",i),window.removeEventListener("blur",x)}},[d]),n}const C=()=>{const d=new Date().getFullYear(),[n,g]=o.useState(d),[i,x]=o.useState({}),[E,f]=o.useState(!1),[h,j]=o.useState(!1),[b,y]=o.useState(!1),w=async()=>{if(n){f(!0);try{const r=await u.get(`/reports/matrix?year=${n}`);x(r.data)}catch(r){console.error("Error fetching matrix report:",r),alert("Gagal memuat data laporan. Pastikan backend berjalan dan tidak ada error."),x({})}finally{f(!1)}}};$(w),o.useEffect(()=>{w()},[n]);const N=o.useMemo(()=>Object.keys(i).length===0?[]:Object.entries(i).map(([r,l])=>{const a=l.reduce((t,s)=>{const c=s.kegiatan.nama_kegiatan;return t[c]||(t[c]={kegiatan_nama:s.kegiatan.nama_kegiatan,rencana_aksi:[]}),t[c].rencana_aksi.push(s),t},{});return{kategori_nama:r,total_rows:l.length,kegiatan_list:Object.values(a)}}),[i]),S=async()=>{j(!0);try{const r=await u.get(`/reports/export-matrix?year=${n}&format=excel`,{responseType:"blob"}),l=window.URL.createObjectURL(new Blob([r.data])),a=document.createElement("a");a.href=l,a.setAttribute("download",`Laporan_Matriks_${n}.xlsx`),document.body.appendChild(a),a.click(),a.remove()}catch(r){console.error("Error exporting to Excel:",r),alert("Gagal mengekspor laporan ke Excel.")}finally{j(!1)}},P=async()=>{y(!0);try{const r=await u.get(`/reports/export-matrix?year=${n}&format=pdf`);r.data.download_url&&window.open(r.data.download_url,"_blank")}catch(r){console.error("Error exporting to PDF:",r),alert("Gagal mengekspor laporan ke PDF.")}finally{y(!1)}},k=r=>r==null?"bg-gray-50":r==100?"bg-green-500 text-white":r>0?"bg-blue-500 text-white":"bg-yellow-400 text-yellow-900",v=(r,l)=>{if(l){if(r==="in_progress"||r==="planned")return"bg-red-500 text-white";if(r==="completed")return"bg-yellow-500 text-yellow-900"}switch(r){case"completed":return"bg-green-500 text-white";case"in_progress":return"bg-blue-500 text-white";case"planned":return"bg-gray-400 text-gray-900";default:return"bg-white"}};return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-6 space-y-4 md:space-y-0 no-print",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Laporan Matriks Kinerja"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:space-x-4 space-y-2 sm:space-y-0",children:[e.jsx("select",{value:n,onChange:r=>g(r.target.value),className:"p-2 border rounded-md",children:[0,1,2,3,4].map(r=>e.jsx("option",{value:d-r,children:d-r},d-r))}),e.jsxs("button",{onClick:S,disabled:h||b,className:"flex items-center bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:bg-gray-400",children:[e.jsx(R,{className:"mr-2"})," ",h?"Mengekspor...":"Ekspor Excel"]}),e.jsxs("button",{onClick:P,disabled:b||h,className:"flex items-center bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 disabled:bg-gray-400",children:[e.jsx(A,{className:"mr-2"})," ",b?"Membuat PDF...":"Ekspor PDF"]})]})]}),E?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx("div",{className:"loader"})}):e.jsxs("div",{id:"print-area",children:[e.jsxs("div",{className:"hidden lg:block overflow-x-auto",children:[e.jsxs("h2",{className:"text-xl font-semibold text-center mb-4",children:["PROGRAM KERJA TAHUN ",n]}),e.jsxs("table",{className:"min-w-full bg-white border-collapse border border-gray-400 text-xs",children:[e.jsxs("thead",{className:"bg-gray-100",children:[e.jsxs("tr",{children:[e.jsx("th",{rowSpan:"2",className:"border border-gray-300 p-2",children:"No"}),e.jsx("th",{rowSpan:"2",className:"border border-gray-300 p-2",children:"Kegiatan"}),e.jsx("th",{rowSpan:"2",className:"border border-gray-300 p-2",children:"Rencana Aksi"}),e.jsx("th",{rowSpan:"2",className:"border border-gray-300 p-2",children:"PIC"}),e.jsx("th",{rowSpan:"2",className:"border border-gray-300 p-2",children:"Status"}),e.jsx("th",{colSpan:"12",className:"border border-gray-300 p-2",children:"Progress Pelaksanaan"})]}),e.jsx("tr",{children:["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Ags","Sep","Okt","Nov","Des"].map(r=>e.jsx("th",{className:"border border-gray-300 p-2 font-normal",children:r},r))})]}),e.jsx("tbody",{children:N.map((r,l)=>{let a=1;return e.jsxs(F.Fragment,{children:[e.jsx("tr",{children:e.jsx("td",{colSpan:"17",className:"bg-gray-200 font-bold p-2 border border-gray-300",children:r.kategori_nama})}),r.kegiatan_list.map(t=>t.rencana_aksi.map((s,c)=>e.jsxs("tr",{children:[c===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{rowSpan:t.rencana_aksi.length,className:"border border-gray-300 p-2 align-top text-center",children:a++}),e.jsx("td",{rowSpan:t.rencana_aksi.length,className:"border border-gray-300 p-2 align-top",children:t.kegiatan_nama})]}),e.jsx("td",{className:"border border-gray-300 p-2",children:s.deskripsi_aksi}),e.jsx("td",{className:"border border-gray-300 p-2",children:s.assigned_to?.name||"-"}),e.jsx("td",{className:`border border-gray-300 p-2 text-center ${v(s.status,s.is_late)}`,children:s.status.replace("_"," ")}),Array.from({length:12}).map((p,M)=>{const _=M+1,m=s.monthly_progress[_];return e.jsx("td",{className:`border border-gray-300 p-2 text-center ${k(m)}`,children:m!=null?`${m}%`:"-"},_)})]},s.id)))]},r.kategori_nama)})})]})]}),e.jsxs("div",{className:"block lg:hidden",children:[e.jsxs("h2",{className:"text-xl font-semibold text-center mb-4",children:["PROGRAM KERJA TAHUN ",n]}),e.jsx("div",{className:"space-y-4",children:N.flatMap(r=>r.kegiatan_list.flatMap(l=>l.rencana_aksi.map(a=>e.jsxs("div",{className:"border rounded-lg p-4 shadow",children:[e.jsx("div",{className:"font-bold text-lg mb-2",children:a.deskripsi_aksi}),e.jsxs("div",{className:"text-sm text-gray-600 mb-1",children:[e.jsx("strong",{children:"Kegiatan:"})," ",l.kegiatan_nama]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-1",children:[e.jsx("strong",{children:"P. Jawab:"})," ",a.assigned_to?.name||"-"]}),e.jsxs("div",{className:`text-sm text-gray-600 mb-3 p-1 rounded inline-block ${v(a.status,a.is_late)}`,children:[e.jsx("strong",{children:"Status:"})," ",a.status.replace("_"," ")]}),e.jsx("h4",{className:"font-semibold mb-2",children:"Progress Bulanan (%)"}),e.jsx("div",{className:"grid grid-cols-3 gap-2 text-center",children:["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Ags","Sep","Okt","Nov","Des"].map((t,s)=>{const c=s+1,p=a.monthly_progress[c]??null;return e.jsxs("div",{className:`p-2 rounded ${k(p)}`,children:[e.jsx("div",{className:"font-bold text-xs",children:t}),e.jsx("div",{className:"text-sm",children:p!=null?`${p}%`:"-"})]},t)})})]},a.id))))})]})]})]})};export{C as default};
