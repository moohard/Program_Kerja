import{r as t,j as e,l as h}from"./index-kK03ZpaK.js";const f=()=>{const[i,u]=t.useState([]),[d,p]=t.useState({}),[g,o]=t.useState(!0),[l,m]=t.useState({user_id:"",action:"",start_date:"",end_date:"",page:1}),[j,N]=t.useState([]);t.useEffect(()=>{(async()=>{try{const a=await h.get("/users");N(a.data.data)}catch(a){console.error("Error fetching users:",a)}})()},[]),t.useEffect(()=>{(async()=>{o(!0);try{const a=new URLSearchParams(l).toString(),c=await h.get(`/audit-logs?${a}`);u(c.data.data),p({current_page:c.data.current_page,last_page:c.data.last_page,total:c.data.total})}catch(a){console.error("Error fetching audit logs:",a)}finally{o(!1)}})()},[l]);const r=s=>{m(a=>({...a,[s.target.name]:s.target.value,page:1}))},x=s=>{m(a=>({...a,page:s}))},n=s=>{try{const a=JSON.parse(s);return e.jsx("pre",{className:"bg-gray-100 p-2 rounded text-xs whitespace-pre-wrap break-all",children:JSON.stringify(a,null,2)})}catch{return e.jsx("span",{className:"text-gray-500",children:"N/A"})}};return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Laporan Jejak Audit"}),e.jsxs("div",{className:"p-4 border rounded-lg bg-gray-50 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Pengguna"}),e.jsxs("select",{name:"user_id",value:l.user_id,onChange:r,className:"w-full p-2 mt-1 border rounded-md",children:[e.jsx("option",{value:"",children:"Semua"}),j.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Aksi"}),e.jsxs("select",{name:"action",value:l.action,onChange:r,className:"w-full p-2 mt-1 border rounded-md",children:[e.jsx("option",{value:"",children:"Semua"}),e.jsx("option",{value:"CREATE",children:"Create"}),e.jsx("option",{value:"UPDATE",children:"Update"}),e.jsx("option",{value:"DELETE",children:"Delete"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Tanggal Mulai"}),e.jsx("input",{type:"date",name:"start_date",value:l.start_date,onChange:r,className:"w-full p-2 mt-1 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Tanggal Selesai"}),e.jsx("input",{type:"date",name:"end_date",value:l.end_date,onChange:r,className:"w-full p-2 mt-1 border rounded-md"})]})]}),g?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx("div",{className:"loader"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto hidden lg:block",children:e.jsxs("table",{className:"min-w-full bg-white text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left",children:"Tanggal"}),e.jsx("th",{className:"p-3 text-left",children:"Pengguna"}),e.jsx("th",{className:"p-3 text-left",children:"Aksi"}),e.jsx("th",{className:"p-3 text-left",children:"Tabel"}),e.jsx("th",{className:"p-3 text-left",children:"Data Lama"}),e.jsx("th",{className:"p-3 text-left",children:"Data Baru"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:i.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-3 whitespace-nowrap",children:new Date(s.created_at).toLocaleString("id-ID")}),e.jsx("td",{className:"p-3",children:s.user?.name||"Sistem"}),e.jsx("td",{className:"p-3",children:s.action}),e.jsxs("td",{className:"p-3",children:[s.table_name," (ID: ",s.record_id,")"]}),e.jsx("td",{className:"p-3 w-1/4",children:n(s.old_values)}),e.jsx("td",{className:"p-3 w-1/4",children:n(s.new_values)})]},s.id))})]})}),e.jsx("div",{className:"space-y-4 lg:hidden",children:i.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-3 pb-3 border-b",children:[e.jsxs("div",{className:"font-bold",children:[s.user?.name||"Sistem"," - ",e.jsx("span",{className:"font-mono text-indigo-600",children:s.action})]}),e.jsx("div",{className:"text-sm text-gray-500 mt-1 sm:mt-0",children:new Date(s.created_at).toLocaleString("id-ID")})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"font-semibold",children:"Tabel:"})," ",s.table_name," (ID: ",s.record_id,")"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1 text-gray-700",children:"Data Lama"}),n(s.old_values)]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1 text-gray-700",children:"Data Baru"}),n(s.new_values)]})]})]},s.id))})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["Total ",d.total," data"]}),e.jsxs("div",{className:"space-x-1",children:[e.jsx("button",{onClick:()=>x(d.current_page-1),disabled:d.current_page===1,className:"px-3 py-1 border rounded-md disabled:opacity-50",children:"Sebelumnya"}),e.jsx("button",{onClick:()=>x(d.current_page+1),disabled:d.current_page===d.last_page,className:"px-3 py-1 border rounded-md disabled:opacity-50",children:"Berikutnya"})]})]})]})};export{f as default};
